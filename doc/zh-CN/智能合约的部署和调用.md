# 智能合约的部署和调用

- [1. 部署合约](#部署合约)

- [2. 调用合约](#调用合约)

  - [2.1 通过 abi 文件构建交易](#通过-abi-文件构建交易)

- [3. 事件推送](#事件推送)

## 部署合约

部署合约需要构建并发送相应的交易到链上执行。

构建合约需要提供合约内容的十六进制字符串，和一些配置参数。

配置参数如下：

| 参数          | 含义                                     |
| ------------- | ---------------------------------------- |
| \$code        | 合约内容，十六进制的字符串。             |
| \$name        | 合约的名称。普通字符串。可选值。         |
| \$codeVersion | 合约的版本。普通字符串。可选值。         |
| \$author      | 合约作者。普通字符串。可选值。           |
| \$email       | 合约作者的邮件地址。普通字符串。可选值。 |
| \$desc        | 合约的描述。普通字符串。可选值。         |
| \$needStorage | 是否需要使用存储。布尔值。可选值。       |

```php
use ontio\core\transaction\TransactionBuilder;
use ontio\network\JsonRpc;

// 合约内容
$code = '';

// 构建交易
$txBuilder = new TransactionBuilder();
$tx = $txBuilder->makeDeployCodeTransaction(
  $code,
  'name',
  '1.0',
  'alice',
  'mail',
  'desc',
  true,
  self::$gasPrice,
  '30000000',
  self::$adminAddress
);

// 签名交易
$txBuilder->signTransaction($tx, self::$adminPrivateKey);

// 发送交易
$rpc = new JsonRpc('http://127.0.0.1:20336');
$res = $rpc->sendRawTransaction($tx->serialize());
```

## 调用合约

合约必须在成功部署后才能调用。 调用合约需要构建并发送相应的交易到链上执行。

### 通过 abi 文件构建交易

针对于 NEO 虚拟机的智能合约可以编译出相应的 `.avm` 文件和 `.abi` 文件。`.abi` 文件是以 JSON 格式存储，包含了描述智能合约的方法和参数的内容。可以通过读取`.abi` 文件方便的构建调用合约的交易。构建的交易可能还需要使用用户的私钥签名。

## 事件推送
